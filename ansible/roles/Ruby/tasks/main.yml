---
- name: Install Rbenv
  apt: package=rbenv state=present
  sudo: yes

- name: Install Readline Headers
  apt: package=libreadline-dev state=present
  sudo: yes

- name: Give Console User Ownership of Rbenv
  file:
    path: /usr/local/rbenv
    state: directory
    owner: "{{ ansible_ssh_user }}"
    mode: 0755
  sudo: yes

- name: Install Rbenv Plugins
  git:
    repo: https://github.com/sstephenson/{{ item }}.git
    dest: /usr/local/rbenv/plugins/{{ item }}/
  notify: Rehash Rbenv
  with_items:
    - ruby-build
    - rbenv-vars
    - rbenv-gem-rehash
    - rbenv-default-gems

- name: Install Binstubs
  git:
    repo: https://github.com/ianheggie/rbenv-binstubs.git
    dest: /usr/local/rbenv/plugins/rbenv-binstubs/
    version: v1.4
  notify: Rehash Rbenv

- name: Set Default Gems
  copy: src=default-gems dest=/usr/local/rbenv/default-gems

- name: Install
  command: rbenv install {{ ruby_version }} creates=/usr/local/rbenv/versions/{{ ruby_version }}
  environment:
    RBENV_ROOT: /usr/local/rbenv

- name: Add Rbenv to Profile
  template: src=rbenv.sh.j2 dest=/etc/profile.d/rbenv.sh
  sudo: yes
