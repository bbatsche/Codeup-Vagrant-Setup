---
- name: Install Rbenv
  apt: package=rbenv state=present
  sudo: yes

- name: Install Rbenv Plugins
  git:
    repo: https://github.com/sstephenson/{{ item }}.git
    dest: /usr/local/rbenv/plugins/{{ item }}/
  sudo: yes
  notify: Rehash Rbenv
  with_items:
    - ruby-build
    - rbenv-vars
    - rbenv-gem-rehash
    - rbenv-default-gems

- name: Install Binstubs
  git:
    repo: https://github.com/ianheggie/rbenv-binstubs.git
    dest: /usr/local/rbenv/plugins/rbenv-binstubs/
    version: v1.4
  sudo: yes
  notify: Rehash Rbenv

- name: Install
  command: rbenv install {{ ruby_version }} creates=/usr/local/rbenv/versions/{{ ruby_version }}
  environment:
    RBENV_ROOT: /usr/local/rbenv
  sudo: yes

- name: Add Rbenv to Profile
  copy: src=rbenv.sh dest=/etc/profile.d/rbenv.sh
  sudo: yes

- name: Install Rack
  gem: name=rack user_install=no state=present
  notify: Rehash Rbenv
  sudo: yes
